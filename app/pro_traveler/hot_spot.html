<div style="height:500px;width:100%" id="chart" ></div>
<script type="text/javascript" src="plugins\js\echarts3\map\js\china.js"></script>
<script type="text/javascript">
var myChart = echarts.init(document.getElementById('chart'));
var myChart2;
var province_chart;
var option;
var data;
var convertData = function(data) {
    var res = [];
    for (var name_ in data) {


        res.push({
            name: name_,
            value: data[name_]
        });

    }
    return res;
};

var circle_hot = function(data) {
    myChart.dispose();
    myChart = echarts.init(document.getElementById('chart'));
    option = {

        tooltip: {
            trigger: 'item'
        },
        geo: {
            map: 'china',
            label: {
                emphasis: {
                    show: false
                }
            },
            roam: true,
            selectedMode: 'single',
            itemStyle: {
                normal: {
                    areaColor: '#FFFFFF',
                    borderColor: '#404a59'
                },
                emphasis: {
                    areaColor: '#DDDDDD'
                }
            }
        },
        series: [{
                name: 'a',
                type: 'scatter',
                coordinateSystem: 'geo',
                data: convertData(data),
                symbolSize: function(val) {
                    return val[2] / 6;
                },
                label: {
                    normal: {
                        formatter: '{b}',
                        position: 'right',
                        show: false
                    },
                    emphasis: {
                        show: true
                    }
                },
                itemStyle: {
                    normal: {
                        color: '#FF6666'
                    }
                }
            },
            {
                name: 'Top 5',
                type: 'effectScatter',
                coordinateSystem: 'geo',
                data: convertData(objKeySort(data, 10)),
                symbolSize: function(val) {
                    return val[2] / 5;
                },
                showEffectOn: 'render',
                rippleEffect: {
                    brushType: 'stroke'
                },
                hoverAnimation: true,
                label: {
                    normal: {
                        formatter: '{b}',
                        position: 'right',
                        show: false
                    }
                },
                itemStyle: {
                    normal: {
                        color: '#FF3300',
                        shadowBlur: 10,
                        shadowColor: '#FF9900'
                    }
                },
                zlevel: 1
            }
        ]
    };

    myChart.setOption(option);
    myChart.on('geoselectchanged', function(param){
        geoselectfun(param);
    });

};

var pure_hot = function(data) {
    myChart.dispose();
    myChart = echarts.init(document.getElementById('chart'));
    option = {
        tooltip: {
            trigger: 'item'
        },
        geo: {
            map: 'china',
            label: {
                emphasis: {
                    show: false
                }
            },
            roam: true,
            selectedMode: 'single',
            itemStyle: {
                normal: {
                    areaColor: '#FFFFFF',
                    borderColor: '#404a59'
                },
                emphasis: {
                    areaColor: '#DDDDDD'
                }
            }
        },
        visualMap: {
            show: false,
            top: 'top',
            min: 0,
            max: 5,
            seriesIndex: 0,
            calculable: true,
            inRange: {
                color: ['blue', 'blue', 'green', 'yellow', 'red']
            }
        },
        series: [{
                name: '景点热度',
                type: 'heatmap',
                coordinateSystem: 'geo',
                data: convertData(data),
                pointSize: 5,
                blurSize: 6
            }


        ]
    };
    myChart.setOption(option);
    myChart.on('geoselectchanged', function(param){
        geoselectfun(param);
    });
};

$(document).ready(function() {

    $("#hot").click(function() {
        pure_hot(data);
    });
    $("#circle").click(function() {
        circle_hot(data);
    });
    $("#bar_select").change(function () {  
        var v = $(this).children('option:selected').val(); 
        bar_plot(data,v);
    }); 
    $('#pro_ctl').click(function(){
        try{
            province_chart.dispose();
        }catch(e){};
        $('#province_div').animate({width:'toggle'});
    }) 
    $.getJSON('pro_traveler/spot.json', function(json_data) {
        data = json_data;
        circle_hot(data);
        bar_plot(data,10);
        // pure_hot(data);
    });

});




function objKeySort(obj, n) { //排序的函数
    var newkey = Object.keys(obj).sort(function(key1, key2) {

        return obj[key2][2] - obj[key1][2]
    }).slice(0, n);
    //先用Object内置类的keys方法获取要排序对象的属性名，再利用Array原型上的sort方法对获取的属性名进行排序，newkey是一个数组
    var newObj = {}; //创建一个新的对象，用于存放排好序的键值对
    for (var i = 0; i < newkey.length; i++) { //遍历newkey数组
        newObj[newkey[i]] = obj[newkey[i]]; //向新创建的对象中按照排好的顺序依次增加键值对
    }

    return newObj; //返回排好序的新对象
}




</script>
