<style type="text/css">
	.content_botton{
		color:rgb(109,109,109);
		margin-left:1rem;
		cursor:pointer;
	}
	.content_botton_active{
		color:rgb(34,93,153);
	}


</style>
<div class="container_title">
	<div style="width:12%;font-size:1.8rem;float:left">热门景点</div>
	<div class='entry' style="line-height: 5rem">景点图</div>
	<div class='entry' style="line-height: 5rem" >热力图</div>

</div>
<div class="row">
      <div class="col-xs-6">
      	<div class="content_title">热度地图
      		<span class="glyphicon glyphicon-question-sign content_illustrate_inactive"  title="基于7、8月用户数据实现">
      		</span>
      		<span class='content_botton'>热力图</span>
      		<span class='content_botton'>热点图</span>
      	</div>
		<div class="content_chart" style="height:500px;width:100%" id="hot_map_chart" ></div>

      </div>
      <div class="col-xs-6">
      	<div class="content_title" >
      		热度排名
      		<span class="glyphicon glyphicon-question-sign content_illustrate_inactive"  title="基于7、8月用户数据实现">
      		</span>
      	</div>
		<div class="content_chart" style="height:500px;width:100%;" id="hot_bar_chart" ></div>

      </div>      
</div>



<script type="text/javascript" src="plugins\js\echarts3\map\js\china.js"></script>
<script type="text/javascript">
var hot_map_chart = echarts.init(document.getElementById('hot_map_chart'));
var hot_bar_chart;
var province_chart;
var option;
var data;
contentBottonFuncArr.push(function(){
	
})
var convertData = function(data) {
    var res = [];
    for (var name_ in data) {


        res.push({
            name: name_,
            value: data[name_]
        });

    }
    return res;
};

var circle_hot = function(data) {
    hot_map_chart.dispose();
    hot_map_chart = echarts.init(document.getElementById('hot_map_chart'));
    option = {

        tooltip: {
            trigger: 'item'
        },
        geo: {
            map: 'china',
            label: {
                emphasis: {
                    show: false
                }
            },
            zoom:1.2,
            top:'middle',
            roam: false,
            selectedMode: 'single',
            itemStyle: {
                normal: {
                    areaColor: 'rgb(241,247,252)',
                    borderColor: '#404a59'
                },
                emphasis: {
                    areaColor: '#DDDDDD'
                }
            }
        },
        series: [{
                name: 'a',
                type: 'scatter',
                coordinateSystem: 'geo',
                data: convertData(data),
                symbolSize: function(val) {
                    return val[2] / 6;
                },
                label: {
                    normal: {
                        formatter: '{b}',
                        position: 'right',
                        show: false
                    },
                    emphasis: {
                        show: true
                    }
                },
                itemStyle: {
                    normal: {
                        color: 'rgb(45,143,202)'
                    }
                }
            },
            {
                name: 'Top 5',
                type: 'effectScatter',
                coordinateSystem: 'geo',
                data: convertData(objKeySort(data, 10)),
                symbolSize: function(val) {
                    return val[2] / 5;
                },
                showEffectOn: 'render',
                rippleEffect: {
                    brushType: 'stroke'
                },
                hoverAnimation: true,
                label: {
                    normal: {
                        formatter: '{b}',
                        position: 'right',
                        show: false
                    }
                },
                itemStyle: {
                    normal: {
                        color: 'rgb(43,117,191)',
                        shadowBlur: 10,
                        shadowColor: '#FF9900'
                    }
                },
                zlevel: 1
            }
        ]
    };

    hot_map_chart.setOption(option);
    hot_map_chart.on('geoselectchanged', function(param){
        geoselectfun(param);
    });

};

var pure_hot = function(data) {
    hot_map_chart.dispose();
    hot_map_chart = echarts.init(document.getElementById('hot_map_chart'));
    option = {
        tooltip: {
            trigger: 'item'
        },
        geo: {
            map: 'china',
            label: {
                emphasis: {
                    show: false
                }
            },
            roam: true,
            selectedMode: 'single',
            itemStyle: {
                normal: {
                    areaColor: 'rgb(211,228,245)',
                    borderColor: '#404a59'
                },
                emphasis: {
                    areaColor: 'rgb(211,228,245)'
                }
            }
        },
        visualMap: {
            show: false,
            top: 'top',
            min: 0,
            max: 5,
            seriesIndex: 0,
            calculable: true,
            inRange: {
                color: ['blue', 'blue', 'green', 'yellow', 'red']
            }
        },
        series: [{
                name: '景点热度',
                type: 'heatmap',
                coordinateSystem: 'geo',
                data: convertData(data),
                pointSize: 5,
                blurSize: 6
            }


        ]
    };
    hot_map_chart.setOption(option);
    hot_map_chart.on('geoselectchanged', function(param){
        geoselectfun(param);
    });
};

var bar_plot = function(data,n) {
    var obj = objKeySort(data, n);
    console.log(obj);
    var y = [];
    var x = [];
    for (var key in obj) {
        y.push(key);
        x.push(obj[key][2]);
    }
    var option2 = {
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'shadow'
            }
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: {
            type: 'value',
            boundaryGap: [0, 0.01],
            min: 90,
            max: 140
        },
        yAxis: {
            type: 'category',
            data: y.reverse()
        },
        series: [{
            type: 'bar',
            data: x.reverse(),
            itemStyle:{
            	normal:{
            		color:'rgb(43,116,189)',
            		borderColor:'rgb(34,93,153)'
            	}
            }

        }]
    };
    try{
        hot_bar_chart.dispose();
    }catch(e){

    }
    hot_bar_chart = echarts.init(document.getElementById('hot_bar_chart'));
    hot_bar_chart.setOption(option2);
};

$(document).ready(function() {

    $("#hot").click(function() {
        pure_hot(data);
    });
    $("#circle").click(function() {
        circle_hot(data);
    });
    $("#bar_select").change(function () {  
        var v = $(this).children('option:selected').val(); 
        bar_plot(data,v);
    }); 
    $('#pro_ctl').click(function(){
        try{
            province_chart.dispose();
        }catch(e){};
        $('#province_div').animate({width:'toggle'});
    }) 
    $.getJSON('pro_traveler/spot.json', function(json_data) {
        data = json_data;
        circle_hot(data);
        bar_plot(data,20);
        // pure_hot(data);
    });

});




function objKeySort(obj, n) { //排序的函数
    var newkey = Object.keys(obj).sort(function(key1, key2) {

        return obj[key2][2] - obj[key1][2]
    }).slice(0, n);
    //先用Object内置类的keys方法获取要排序对象的属性名，再利用Array原型上的sort方法对获取的属性名进行排序，newkey是一个数组
    var newObj = {}; //创建一个新的对象，用于存放排好序的键值对
    for (var i = 0; i < newkey.length; i++) { //遍历newkey数组
        newObj[newkey[i]] = obj[newkey[i]]; //向新创建的对象中按照排好的顺序依次增加键值对
    }

    return newObj; //返回排好序的新对象
}




</script>
